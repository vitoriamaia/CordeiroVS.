jQuery(function(a){var b=!1,c=a("#yith-wcbep-categories-filter"),d=a("#yith-wcbep-table-wrap .wp-list-table"),e=a("#yith-wcbep-custom-input"),f=null,g=null,h=new Array,i=new Array,j=new Array,k=new Array,l=a("#yith-wcbep-get-products"),m=a("#yith-wcbep-filter-form"),n=a("#yith-wcbep-categories-filter"),o=a("#yith-wcbep-regular-price-filter-select"),p=a("#yith-wcbep-regular-price-filter-value"),q=a("#yith-wcbep-sale-price-filter-select"),r=a("#yith-wcbep-sale-price-filter-value"),s=a("#yith-wcbep-per-page-filter"),t=a("#yith-wcbep-reset-filters"),v=(a("#yith-wcbep-table-wrap"),a("#yith-wcbep-bulk-edit-btn")),w=a("#yith-wcbep-bulk-editor"),x=a("#yith-wcbep-bulk-apply"),C=(a("#yith-wcbep-regular-price-bulk-select"),a("#yith-wcbep-regular-price-bulk-value"),a("#yith-wcbep-sale-price-bulk-select"),a("#yith-wcbep-sale-price-bulk-value"),a("#yith-wcbep-save")),D=new Array,E=new Array,G=(a("#yith-wcbep-message"),{message:null,overlayCSS:{background:"#000",opacity:.6},ignoreIfBlocked:!0}),H={message:null,overlayCSS:{background:"#000 url()",opacity:.6,cursor:"default"}},I=function(a){a=a||!1,a&&e.hide(),f&&(f.html(e.html()),e.html(""),f=null),K()},J=[],K=function(b){var c=0;J=[],E=[],d.find("tbody#the-list > tr").each(function(){var b=a(this).children("td"),d=!1;if(b.length>0){var e=1,f=[];f.push(0),b.each(function(){a(this).html()!=h[c][e]?(a(this).addClass("yith-wcbep-table-modified-td"),d=!0,f.push(1)):(a(this).removeClass("yith-wcbep-table-modified-td"),f.push(0)),e++}),J.push(f),d&&E.push(c),c++}}),b&&create_current_html_matrix()},L=function(){d=a("#yith-wcbep-table-wrap .wp-list-table"),M(),d.find("th#cb input").on("click",function(){var b=d.find("tbody#the-list th.check-column > input");a(this).is(":checked")?b.attr("checked",!0):b.attr("checked",!1)}),d.on("click","td.regular_price, td.sale_price",function(b){b.stopPropagation(),I(!1),f=a(b.target),g=a(b.target),e.width(f.width()),e.height(f.height()),e.show(),e.offset(f.offset()),e.html(f.html())})},M=function(){h=new Array,k=new Array,d.find("tbody tr").each(function(){var b=a(this).find("td"),c=[a(this).find("th")];if(b.length>0){var d=[!1];b.each(function(){d.push(a(this).html()),c.push(a(this))}),h.push(d),k.push(c)}})},N=function(){var b=new Array;return d.find("tbody tr").each(function(){var c=a(this).find("td");if(c.length>0){var d=[!1];c.each(function(){d.push(a(this).html())}),b.push(d)}}),b},O=function(){var b=new Array;return d.find("thead tr th").each(function(){b.push(a(this).attr("id"))}),b},P=function(){var b=0,c=new Array;return d.find("tbody tr").each(function(){a(this).find("th input:checked").length>0&&c.push(b),b++}),c},Q=function(){w.find("input.is_resetable").each(function(){a(this).val("")}),w.find("select.is_resetable").each(function(){a(this).prop("selectedIndex",0)})},R=function(){m.find("input.is_resetable").each(function(){a(this).val("")}),m.find("select.is_resetable").each(function(){a(this).prop("selectedIndex",0)}),c.chosen("destroy"),c.prop("selectedIndex",-1),c.chosen({width:"95%"})},S=function(){if(g)for(index in k){var b=k[index];for(index_col in b)if(a(b[index_col])[0]==g[0]&&void 0!==k[parseInt(index)+1])return a(k[parseInt(index)+1][index_col]).trigger("click"),void e.selectText()}};a.fn.selectText=function(){var a=document,b=this[0];if(a.body.createTextRange){var c=document.body.createTextRange();c.moveToElementText(b),c.select()}else if(window.getSelection){var d=window.getSelection(),c=document.createRange();c.selectNodeContents(b),d.removeAllRanges(),d.addRange(c)}},c.chosen({width:"95%"}),e.offset(new Array(0,0)),j=O(),w.draggable(),a("html").on("click",function(){I(!0)}),e.on("click",function(a){a.stopPropagation()}).keypress(function(a){13==a.which&&(I(!0),a.stopPropagation(),setTimeout(S,0))}),l.on("click",function(){var a={f_categories:n.val(),f_reg_price_select:o.val(),f_reg_price_value:p.val(),f_sale_price_select:q.val(),f_sale_price_value:r.val(),f_per_page:s.val()};list.update(a)}),v.on("click",function(){var b=d.find("tbody th input:checked"),c=new Array;if(b.each(function(){c.push(a(this).val())}),c.length<1)return void alert(ajax_object.no_product_selected);w.fadeIn(),a("#wpwrap").block(H),D=P()}),a("#yith-wcbep-bulk-cancel").add(".yith-wcbep-close-bulk-editor").on("click",function(){w.fadeOut(),Q(),a("#wpwrap").unblock()}),w.keypress(function(a){13==a.which&&x.trigger("click")}),x.on("click",function(){for(var b in D){var c=D[b],d=["regular_price","sale_price"];for(var e in d)if(j.indexOf(d[e])>-1){var f=a(k[c][j.indexOf(d[e])]),g=parseFloat(f.html()),h="",i=a("#yith-wcbep-"+d[e]+"-bulk-select").val(),l=a("#yith-wcbep-"+d[e]+"-bulk-value").val();if((!isNaN(l)&&""!=l||"del"==i)&&f.find(".not_editable").length<1){switch(i){case"new":h=parseFloat(l);break;case"inc":g=isNaN(g)?0:g,h=g+parseFloat(l);break;case"dec":h=g>0?g-parseFloat(l):"";break;case"incp":h=g>0?g+g*parseFloat(l)/100:"";break;case"decp":h=g>0?g-g*parseFloat(l)/100:"";break;case"decfr":var m=a(k[c][j.indexOf("regular_price")]);g=parseFloat(m.html()),isNaN(g)||""==g||(h=g-parseFloat(l));break;case"decpfr":var m=a(k[c][j.indexOf("regular_price")]);g=parseFloat(m.html()),isNaN(g)||""==g||(h=g-g*parseFloat(l)/100);break;case"del":h=""}""!=h&&(h<0||isNaN(h))&&(h=0),f.html(h)}}}w.fadeOut(),Q(),a("#wpwrap").unblock()}),t.on("click",function(){R()}),C.on("click",function(){if(K(),E.length>0){d.block(G),C.prop("disabled",!0),v.prop("disabled",!0),i=N();var c=[],e=[];for(var f in E){var g=E[f];c.push(i[g]),e.push(J[g])}for(var h in e){var k=e[h];for(ic in k){0==k[ic]&&2!=ic&&(c[h][ic]=null)}}var n=c.length,o=n,p=0,r=a("#yith-wcbep-percentual-container");r.html('<span class="yith-wcbep-percentual" style="width:'+p+'%;">'+p+"%</span>");var s=r.find("span.yith-wcbep-percentual");r.fadeIn();var t=c.length,u=function(d){if(d<t){var f={matrix_keys:j,matrix_modify:[c[d]],edited_matrix:[e[d]],action:"yith_wcbep_bulk_edit_products"};a.ajax({type:"POST",data:f,url:ajaxurl,success:function(a){b&&console.log(a)},complete:function(a){b&&console.log(a),n--,p=parseInt(100*(o-n)/o),s.html(p+"%"),s.animate({width:p+"%"},200),u(++d)}})}else l.trigger("click"),r.delay(1500).fadeOut()};t>0&&u(0)}}),list={init:function(){var b;L(),a(".tablenav-pages a, .manage-column.sortable a, .manage-column.sorted a").on("click",function(a){a.preventDefault();var b=this.search.substring(1),c={paged:list.__query(b,"paged")||"1",order:list.__query(b,"order")||"asc",orderby:list.__query(b,"orderby")||"date",f_categories:n.val(),f_reg_price_select:o.val(),f_reg_price_value:p.val(),f_sale_price_select:q.val(),f_sale_price_value:r.val(),f_per_page:s.val()};list.update(c)}),a("input[name=paged]").on("keyup",function(d){13==d.which&&d.preventDefault();var e={paged:parseInt(a("input[name=paged]").val())||"1",order:a("input[name=order]").val()||"asc",orderby:a("input[name=orderby]").val()||"date"};window.clearTimeout(b),b=window.setTimeout(function(){list.update(e)},500)})},update:function(b){d.block(G),C.prop("disabled",!0),v.prop("disabled",!0),a.ajax({url:ajaxurl,data:a.extend({_ajax_yith_wcbep_list_nonce:a("#_ajax_yith_wcbep_list_nonce").val(),action:"_ajax_fetch_yith_wcbep_list"},b),success:function(b){var b=a.parseJSON(b);b.rows.length&&a("#the-list").html(b.rows),b.column_headers.length&&a("thead tr, tfoot tr").html(b.column_headers),b.pagination.bottom.length&&a(".tablenav.top .tablenav-pages").html(a(b.pagination.top).html()),b.pagination.top.length&&a(".tablenav.bottom .tablenav-pages").html(a(b.pagination.bottom).html()),list.init(),d.unblock(),C.prop("disabled",!1),v.prop("disabled",!1),M()}})},__query:function(a,b){for(var c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==b)return e[1]}return!1}},list.init()});